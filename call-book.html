<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Booking Form</title>
  <style>
    ul {
      list-style-type: none;
    }
  </style>
</head>
<body>
  <h2>Booking Form</h2>
  
  <form id="bookingForm">
    <label for="username">Username:</label>
    <input type="text" id="username" required>
    <br>
    <label for="email">Email:</label>
    <input type="email" id="email" required>
    <br>
    <input type="submit" value="Add User">
  </form>
  
  <h3>Booked Users:</h3>
  <ul id="userList"></ul>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
  <script>
    // Function to handle form submission
    function addUser(e) {
      e.preventDefault();
      
      // Get input values
      var usernameInput = document.getElementById('username');
      var emailInput = document.getElementById('email');
      var username = usernameInput.value;
      var email = emailInput.value;
      
      // Create user object
      var user = {
        _id:id,
        username: username,
        email: email
      };
      
      // Get existing users from local storage or initialize an empty array
      var users = JSON.parse(localStorage.getItem('users')) || [];
      
      // Add the new user to the array
      users.push(user);
      
      // // Store the updated users array in local storage
      // localStorage.setItem('users', JSON.stringify(users));
      
      axios.post('https://crudcrud.com/api/1f796ca65eb74305b57f58c46596d2a9/appiontmentData',user)
      .then(res=>{
        console.log(res)
      })
      .catch(err=>{
        console.log(err)
      });

      // // Display the user on the screen
       displayUser(user);
      
      // Clear the form inputs
      usernameInput.value = '';
      emailInput.value = '';
    }
    
    // Function to display a user on the screen
    function displayUser(user) {
      var userList = document.getElementById('userList');
      
      // Create list item for the user
      var listItem = document.createElement('li');
       // Create username span
       var usernameSpan = document.createElement('span');
      usernameSpan.textContent = 'Username: ' + user.username + ', ';
      listItem.appendChild(usernameSpan);
      
      // Create email span
      var emailSpan = document.createElement('span');
      emailSpan.textContent = 'Email: ' + user.email;
      listItem.appendChild(emailSpan);

      // Create edit button
      var editButton = document.createElement('button');
      editButton.textContent = 'Edit';
      editButton.addEventListener('click', function() {
        // Prompt user for new description
        const name = prompt('Enter the corrected description:');
        const email=prompt('enter correct email');
  
        // Update the description span
       // usernameSpan.textContent = newDescription;
  
        // Update the item object
        //user.username = newDescription;

        
    var updatedUser = {
      //_id:id,
      username:name,
      email:email
    };
  

        axios.put(`https://crudcrud.com/api/1f796ca65eb74305b57f58c46596d2a9/appiontmentData/${user._id}`,updatedUser)
  .then(res=>{
    console.log("Username:"+res.data);
  })
  .catch(err=>{
    console.log(err);
  })
})    
      listItem.appendChild(editButton);

      var deleteButton = document.createElement('button');
      deleteButton.textContent = 'Delete';
      deleteButton.addEventListener('click', function() {
        deleteUser(user);
        listItem.remove();
      });
      
      // Append the delete button to the list item
      listItem.appendChild(deleteButton);
      
      // Append the list item to the user list
      userList.appendChild(listItem);
    }
    // Function to delete a user
    function deleteUser(user) {
      // var users = JSON.parse(localStorage.getItem('users')) || [];
      
      // // Find the index of the user in the users array
      // var userIndex = users.findIndex(function(u) {
      //   return u.username === user.username && u.email === user.email;
      // });
      // if (userIndex !== -1) {
      //   users.splice(userIndex, 1);
      //   localStorage.setItem('users', JSON.stringify(users));
      // }
      axios.delete('https://crudcrud.com/api/1f796ca65eb74305b57f58c46596d2a9/appiontmentData/64a5a5a8c632b703e83093e6')
     
      .then(res=>{console.log(res)})
      .catch(err=>{console.log(err)});
    }
  //   function editUser(user) {
  // var name = prompt('Enter the new username:');

  // if (name !== null && name.trim() !== '') {
  //   var users = JSON.parse(localStorage.getItem('users')) || [];

  //   var userIndex = users.findIndex(function(u) {
  //     return u.username === user.username && u.email === user.email;
  //   });

  //   if (userIndex !== -1) {
  //     users[userIndex].username = username;

  //     localStorage.setItem('users', JSON.stringify(users));
  //   }
  // }
//   axios.put('https://crudcrud.com/api/1f796ca65eb74305b57f58c46596d2a9/appiontmentData/64a5a69fc632b703e83093e8')
//   .then(res=>{
//     console.log(res);
//   })
//   .catch(err=>{
//     console.log(err);
//   })
// //}


    
   // Retrieve existing users from local storage and display them on page load
    window.addEventListener("DOMContentLoaded", ()=>{
    //   var users = JSON.parse(localStorage.getItem('users')) || [];
      
    //   // Display each user on the screen
    //   users.forEach(function(user) {
    //     displayUser(user);
    //   });
    // });

    axios.get("https://crudcrud.com/api/1f796ca65eb74305b57f58c46596d2a9/appiontmentData")
    .then(res=>{
      console.log(res)
       
      for(var i=0;i<res.data.length;i++){
        displayUser(res.data[i]);
      }
      

    })
    .catch(err=>{
      console.log(err);
    })
  })
    
    // Add form submission event listener
    var bookingForm = document.getElementById('bookingForm');
    bookingForm.addEventListener('submit', addUser);
  </script>

</body>
</html>